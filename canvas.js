(()=>{let c=document.createElement("canvas");let ct=c.getContext("2d");let style=k=>getComputedStyle(c).getPropertyValue(`--${k}`);let draw=o=>{let x=o.x,y=o.y,r=o.r,t=o.t,a=o.a,w=o.w,h=o.h;c.width=w;c.height=h;ct.clearRect(0,0,w,h);ct.lineWidth=3*window.devicePixelRatio;(()=>{if (!o.cartesian) return;ct.beginPath();ct.strokeStyle=style("cartesian");ct.moveTo(w/2+x,0);ct.lineTo(w/2+x,h);ct.moveTo(0,h/2-y);ct.lineTo(w,h/2-y);ct.stroke();if (o,r==0) {ct.beginPath();ct.fillStyle=style("origin");ct.arc(w/2,h/2,10,0,2*PI,false);ct.fill();}})();(()=>{if (!o.polar) return;if (r>0) {ct.beginPath();ct.strokeStyle=style("polar");ct.arc(w/2,h/2,r,0,2*PI,false);ct.moveTo(w/2,h/2);let R=hypot(w/2,h/2)*1.2;ct.lineTo(w/2+R*cos(t),h/2-R*sin(t));ct.stroke();}})();(o=>{if (!o.on) return;let R=hypot(w/2,h/2);let m=sqrt(w/2+R);let f=(p1,p2)=>{let a=(p1?+1:-1)/2*m**2;let b=p2*m*(p1?o.v:o.u);let c=(p1?-1:+1)/2*(p1?o.v:o.u)**2;ct.moveTo(c+w/2,h/2);ct.quadraticCurveTo(c+w/2,-b/2+h/2,a+c+w/2,-b+h/2);};ct.beginPath();ct.strokeStyle=style("parabolic");if (o.v==0) {ct.moveTo(w/2,h/2);ct.lineTo(w,h/2);}else {f(true,+1);f(true,-1);}if (o.u==0) {ct.moveTo(w/2,h/2);ct.lineTo(0,h/2);}else {f(false,+1);ct.stroke();ct.beginPath();ct.strokeStyle=style("parabolic-counterpart");f(false,-1);}ct.stroke();})(o.parabolic);(o=>{if (!o.on) return;ct.beginPath();ct.strokeStyle=style("elliptic");if (o.u==0) {ct.moveTo(-a+w/2,h/2);ct.lineTo(+a+w/2,h/2);}else {ct.ellipse(w/2,h/2,a*cosh(o.u),a*sinh(o.u),0,0,2*PI,false);}if ((o.v==0)||(abs(o.v)==PI)) {let d=o.v==0?+1:-1;ct.moveTo(+d*a+w/2,h/2);ct.lineTo((+d+1)*w/2,h/2);ct.stroke();ct.beginPath();ct.strokeStyle=style("elliptic-counterpart");ct.moveTo(-d*a+w/2,h/2);ct.lineTo((-d+1)*w/2,h/2);}else if (abs(o.v)==PI/2) {let d=sign(o.v);ct.moveTo(w/2,(+d+1)*h/2);ct.lineTo(w/2,h/2);ct.stroke();ct.beginPath();ct.strokeStyle="rgba(0,153,0,0.3)";ct.lineTo(w/2,(-d+1)*h/2);}else {let p=min(acosh(w/(2*a*abs(cos(o.v)))),asinh(h/(2*a*abs(sin(o.v)))))+0.1;let m=p/2;let f=(sx,sy)=>{let c=+sx*cos(o.v),s=-sy*sin(o.v);ct.moveTo(a*c+w/2,h/2);ct.quadraticCurveTo(a*c+w/2,a*s*(1/tanh(m)-1/sinh(m))+h/2,a*c*cosh(m)+w/2,a*s*sinh(m)+h/2);ct.quadraticCurveTo(a*c*(1/sinh(p)-1/sinh(m))/(1/tanh(p)-1/tanh(m))+w/2,a*s*(1/cosh(m)-1/cosh(p))/(tanh(p)-tanh(m))+h/2,a*c*cosh(p)+w/2,a*s*sinh(p)+h/2);};f(+1,+1);ct.stroke();ct.beginPath();ct.strokeStyle="rgba(0,153,0,0.3)";f(+1,-1);f(-1,+1);f(-1,-1);}ct.stroke();})(o.elliptic);(o=>{if (!o.on) return;ct.beginPath();ct.strokeStyle=style("bipolar");if (o.v==0) {ct.moveTo(w/2,0);ct.lineTo(w/2,h);}else ct.arc(a/tanh(o.v)+w/2,h/2,abs(a/sinh(o.v)),0,2*PI,false);if (o.u==0) {ct.moveTo(+a+w/2,h/2);ct.lineTo(+w,h/2);ct.moveTo(-a+w/2,h/2);ct.lineTo(-w,h/2);ct.stroke();ct.beginPath();ct.strokeStyle=style("bipolar-counterpart");ct.moveTo(+a+w/2,h/2);ct.lineTo(-a+w/2,h/2);}else {let x=w/2,y=-a/tan(o.u)+h/2,r=abs(a/sin(o.u));let t=[-atan2(-a/tan(o.u),+a),-atan2(-a/tan(o.u),-a)];ct.moveTo(a+w/2,h/2);ct.arc(x,y,r,t[0],t[1],o.u>0);ct.stroke();ct.beginPath();ct.strokeStyle=style("bipolar-counterpart");ct.arc(x,y,r,t[0],t[1],o.u<0);}ct.stroke();})(o.bipolar);};window.res("canvas",{name:"Canvas",artifact:c,draw:draw,redrawOnSchemeChanged:true});})();